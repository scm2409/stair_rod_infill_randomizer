# Requirements Document

## Introduction

This document specifies the requirements for a railing infill generator application that calculates and generates random rod arrangements for filling railing frames. The application supports multiple railing shapes with extensible parameters and generates visual representations of the rod placements.

## Glossary

### Core Concepts

- **Shape Type**: The geometric configuration of a railing frame (e.g., staircase, rectangular). Each shape type defines how the frame boundary is constructed based on specific dimensional parameters.

- **Staircase Shape**: A railing frame configuration for stairs, consisting of two vertical posts, an angled handrail connecting the post tops, and a stepped bottom boundary following the stair steps.

- **Rectangular Shape**: A railing frame configuration with four straight sides forming a rectangle.

- **Railing Frame**: The outer boundary structure consisting of physical rods (layer 0) that define the perimeter of the railing. The frame is generated from a shape type and its parameters. For example, a staircase shape produces a frame with two posts, an angled handrail, and stepped bottom rods.

- **Railing Infill**: The interior filling consisting of rods (layer ≥ 1) arranged within the frame boundary. The infill is generated by algorithms and organized into layers.

- **Rod**: A physical bar element represented as a line segment with start/end points, cut angles, weight, and layer assignment. Rods are used for both frame (layer 0) and infill (layer ≥ 1).

### Relationship: Shape Type → Railing Frame → Railing Infill

1. A **Shape Type** (e.g., staircase) with its parameters defines the geometric configuration
2. The shape type generates a **Railing Frame** containing frame rods (layer 0) and boundary polygon
3. A **Generator** creates **Railing Infill** containing infill rods (layer ≥ 1) within the frame boundary

### System Components

- **Generator**: The system component that calculates and creates infill rod arrangements within a given frame boundary

- **Generator Type**: The specific algorithm or strategy used for generating infill (e.g., random placement, pattern-based, ML-based)

- **Quality Evaluator**: The component that assesses the quality of a generated infill arrangement using a fitness function

- **Evaluation Criteria**: The rules and metrics used to determine if an infill arrangement is acceptable (e.g., hole uniformity, anchor spacing)

- **Iteration**: A single attempt at generating an infill arrangement within an iterative generation process

### Parameters

- **Shape Parameters**: The dimensional values that define a specific shape configuration (e.g., post length, stair width, and number of steps for staircase shapes; width and height for rectangular shapes)

- **Infill Parameters**: The configuration values that control rod placement and arrangement (e.g., number of rods, maximum rod length, angle deviation)

- **Generator Parameters**: The configuration values specific to a generator type that control its algorithm behavior (e.g., maximum iterations, maximum duration)

### User Interface

- **UI Application**: The graphical user interface for interacting with the generator, visualizing results, and managing projects

## Requirements

### Requirement 1

**User Story:** As a user, I want to generate random rod arrangements for railing infill, so that I can create unique filling patterns for railing frames

#### Acceptance Criteria

1. THE Generator SHALL create random arrangements of rods within the railing frame boundaries
2. THE Generator SHALL organize infill rods into configurable layers
3. THE Generator SHALL accept a number of layers parameter with a default value of two layers
4. THE Generator SHALL ensure rods within the same layer do not cross each other
5. THE Generator SHALL allow rods in different layers to cross each other
6. THE Generator SHALL ensure rods remain within the railing frame boundaries
7. THE Generator SHALL produce different arrangements on each generation request
8. THE Generator SHALL calculate the positions and dimensions for all rods in the infill

### Requirement 1.1

**User Story:** As a user, I want the random generator to iteratively improve results, so that I receive high-quality infill arrangements

#### Acceptance Criteria

1. THE Generator SHALL evaluate each generated arrangement using quality criteria (fitness function)
2. THE Generator SHALL iterate and generate new arrangements until an acceptable solution is found
3. THE Generator SHALL respect a maximum iteration limit to prevent infinite loops
4. WHEN the maximum iteration limit is reached, THE Generator SHALL return the best arrangement found
5. THE Generator SHALL log the number of iterations performed during generation

### Requirement 2

**User Story:** As a user, I want to define stair-shaped railing frames, so that I can generate infill for staircase railings

#### Acceptance Criteria

1. THE Railing Frame SHALL support stair shape type as a configuration option
2. THE Railing Frame SHALL accept post length parameter for the vertical posts
3. THE Railing Frame SHALL accept stair width parameter for the horizontal distance between the two posts
4. THE Railing Frame SHALL accept stair height parameter for the vertical distance between the base of the first post and the base of the second post
5. THE Railing Frame SHALL accept number of steps parameter
6. THE Railing Frame SHALL define the frame with two vertical posts of equal length on left and right sides
7. THE Railing Frame SHALL connect the top of the posts with an angled line representing the handrail
8. THE Railing Frame SHALL define the bottom boundary following the stair steps rather than a straight line
9. THE Railing Frame SHALL validate stair parameters for geometric consistency
10. THE Generator SHALL generate rod arrangements that fit within the stair-shaped boundary

### Requirement 3

**User Story:** As a user, I want to define rectangular railing frames, so that I can generate infill for flat railings

#### Acceptance Criteria

1. THE Railing Frame SHALL support rectangular shape type as a configuration option
2. THE Railing Frame SHALL accept width and height parameters for rectangular shapes
3. THE Railing Frame SHALL validate rectangular parameters for positive dimensions
4. THE Generator SHALL generate rod arrangements that fit within the rectangular boundary

### Requirement 4

**User Story:** As a developer, I want an extensible shape system, so that new railing shapes can be added in the future without major refactoring

#### Acceptance Criteria

1. THE Railing Frame SHALL use a plugin-based or inheritance-based architecture for shape types
2. THE Railing Frame SHALL define a common interface for all shape types
3. WHEN a new shape type is added, THE Railing Frame SHALL support it without modifying existing shape implementations
4. THE Railing Frame SHALL allow each shape type to define its own specific parameters
5. THE Railing Frame SHALL allow each shape type to define default parameter values in configuration files

### Requirement 4.1

**User Story:** As a developer, I want an extensible generator system, so that new infill generation algorithms can be added in the future

#### Acceptance Criteria

1. THE Generator SHALL use a plugin-based or inheritance-based architecture for generator types
2. THE Generator SHALL define a common interface for all generator types
3. WHEN a new generator type is added, THE Generator SHALL support it without modifying existing generator implementations
4. THE Generator SHALL allow each generator type to define its own specific parameters
5. THE Generator SHALL allow each generator type to define default parameter values in configuration files

### Requirement 5

**User Story:** As a user, I want to configure shape-specific parameters, so that I can precisely define the dimensions of my railing frame

#### Acceptance Criteria

1. THE UI Application SHALL provide input fields for shape-specific dimensional parameters
2. WHEN a shape type is selected, THE UI Application SHALL display only the relevant parameters for that shape
3. THE Railing Frame SHALL validate all dimensional parameters before generation
4. THE UI Application SHALL provide clear error messages for invalid parameter values
5. THE UI Application SHALL provide input for frame rod weight per meter parameter in kilograms per meter
6. THE UI Application SHALL use centimeters as the default unit for all length measurements
7. THE UI Application SHALL use kilograms as the unit for all weight measurements
8. THE UI Application SHALL load default frame rod weight per meter from configuration files

### Requirement 6

**User Story:** As a user, I want to configure infill parameters, so that I can control how the rods are arranged within the frame

#### Acceptance Criteria

1. THE UI Application SHALL provide input fields for infill-specific parameters
2. THE Generator SHALL accept infill parameters that control rod placement behavior
3. THE Generator SHALL apply infill parameters consistently across all shape types
4. THE Railing Frame SHALL allow each shape type to define shape-specific infill constraints
5. THE UI Application SHALL provide input for infill rod weight per meter parameter in kilograms per meter
6. THE UI Application SHALL load default infill parameter values from configuration files
7. THE UI Application SHALL load default infill rod weight per meter from configuration files
8. THE UI Application SHALL allow users to modify infill parameters in the GUI

### Requirement 6.1

**User Story:** As a user, I want to configure generator-specific parameters, so that I can control the behavior of different generation algorithms

#### Acceptance Criteria

1. THE UI Application SHALL provide input fields for generator-specific parameters
2. WHEN a generator type is selected, THE UI Application SHALL display only the relevant parameters for that generator
3. THE Generator SHALL accept generator-specific parameters that control its algorithm behavior
4. THE UI Application SHALL load default generator parameter values from configuration files
5. THE UI Application SHALL allow users to modify generator parameters in the GUI

### Requirement 6.1.1

**User Story:** As a user, I want to configure random infill generator parameters, so that I can control the characteristics of the generated rod arrangement

#### Acceptance Criteria

1. THE Generator SHALL accept a number of infill rods parameter
2. THE Generator SHALL accept a maximum infill rod length parameter
3. THE Generator SHALL accept a maximum angle deviation from vertical parameter
4. THE Generator SHALL accept a number of layers parameter with default value of two
5. THE Generator SHALL accept a minimum distance between anchor points parameter
6. THE Generator SHALL ensure infill rods connect to the frame at anchor points
7. THE Generator SHALL respect the minimum distance constraint between consecutive anchor points on the frame
8. THE Generator SHALL distribute infill rods evenly across all layers
9. WHEN distributing rods across layers, THE Generator SHALL ensure the difference between the layer with the most rods and the layer with the fewest rods does not exceed thirty percent of the total number of rods
10. THE UI Application SHALL provide input fields for all random generator parameters
11. THE UI Application SHALL load default values for all random generator parameters from configuration files

### Requirement 6.2

**User Story:** As a user, I want to configure quality evaluation criteria for the random generator, so that I can control what constitutes an acceptable infill arrangement

#### Acceptance Criteria

1. THE Quality Evaluator SHALL accept a maximum hole area parameter in square centimeters
2. THE Quality Evaluator SHALL calculate hole areas between infill rods considering all layers and the frame
3. THE Quality Evaluator SHALL reject arrangements where any hole area exceeds the maximum
4. THE Quality Evaluator SHALL assess generated arrangements against the defined criteria
5. THE Quality Evaluator SHALL return a quality score or pass/fail result for each arrangement
6. THE UI Application SHALL provide input fields for evaluation criteria parameters
7. THE UI Application SHALL load default evaluation criteria from configuration files

### Requirement 6.2.1

**User Story:** As a developer, I want a fitness function that evaluates arrangement quality, so that the generator can find optimal solutions

#### Acceptance Criteria

1. THE Quality Evaluator SHALL calculate a fitness score based on multiple quality measures
2. THE Quality Evaluator SHALL favor arrangements where all holes are approximately the same size. Ideally, all holes would be the same size.
3. THE Quality Evaluator SHALL favor arrangements where the incircles of all holes have approximately the same radius. Ideally, the incircles of all holes would be the same size.
4. THE Quality Evaluator SHALL penalize arrangements where infill rods are nearly vertical
5. THE Quality Evaluator SHALL penalize arrangements where infill rod angles approach the maximum deviation angle
6. THE Quality Evaluator SHALL favor arrangements with evenly distributed anchor point spacing along the frame
7. THE Quality Evaluator SHALL accept configurable weight parameters for each quality criterion
8. THE Quality Evaluator SHALL load criterion weight values from configuration files
9. THE Quality Evaluator SHALL combine all quality measures into a single weighted fitness score
10. THE Quality Evaluator SHALL use the fitness score to compare and rank different arrangements

### Requirement 6.3

**User Story:** As a user, I want to configure the maximum iteration limit for the random generator, so that I can balance quality with generation time

#### Acceptance Criteria

1. THE Generator SHALL accept a maximum iteration limit parameter
2. THE Generator SHALL accept a maximum duration limit parameter
3. THE Generator SHALL stop iterating when one of the maximum limit is reached
4. THE Generator SHALL stop iterating when an acceptable arrangement is found before a maximum limit is reached
5. THE UI Application SHALL provide an input field for maximum iteration limit and duration limit
6. THE UI Application SHALL load a default maximum iteration/duration value from configuration files
7. THE UI Application SHALL stop if cancel is clicked during generation and should show the best result generated so far.

### Requirement 7

**User Story:** As a user, I want a graphical interface to interact with the generator, so that I can easily create and visualize railing infill designs

#### Acceptance Criteria

1. THE UI Application SHALL provide a graphical user interface
2. THE UI Application SHALL display a vector-based viewport with visual representation of the railing frame and infill
3. THE UI Application SHALL render frame and infill as simple lines in the viewport
4. THE UI Application SHALL render the frame in a distinct color different from infill rods
5. THE UI Application SHALL render infill rods with colors assigned by layer
6. THE UI Application SHALL use different colors for each infill layer
7. THE UI Application SHALL allow users to select shape types from available options
8. THE UI Application SHALL allow users to select generator types from available options
9. THE UI Application SHALL provide an "Update Shape" button to render the frame without infill (short-running operation)
10. THE UI Application SHALL provide a "Generate Infill" button to trigger infill generation (long-running operation)
11. THE UI Application SHALL update the viewport visualization when shape or infill is updated
12. THE UI Application SHALL dynamically update parameter input fields based on selected shape and generator types

### Requirement 7.1

**User Story:** As a user, I want to preview the railing frame shape before generating infill, so that I can verify the dimensions are correct

#### Acceptance Criteria

1. WHEN the "Update Shape" button is pressed, THE UI Application SHALL render the railing frame in the viewport without infill
2. THE UI Application SHALL complete shape rendering quickly as a short-running operation
3. THE UI Application SHALL display the frame boundary based on current shape parameters
4. THE UI Application SHALL clear any existing infill from the viewport when updating shape

### Requirement 7.2

**User Story:** As a user, I want to zoom and pan the viewport, so that I can examine details and navigate large designs

#### Acceptance Criteria

1. WHEN the user scrolls the mouse wheel, THE UI Application SHALL zoom the viewport in or out
2. THE UI Application SHALL use the mouse cursor position as the zoom origin
3. THE UI Application SHALL support panning the viewport using mouse drag operations
4. THE UI Application SHALL maintain smooth viewport navigation during zoom and pan operations

### Requirement 7.3

**User Story:** As a user, I want to enumerate and identify individual lines, so that I can reference specific frame or infill elements

#### Acceptance Criteria

1. THE UI Application SHALL provide a toggle control to show or hide line enumeration
2. WHEN enumeration is visible, THE UI Application SHALL display a numbered marker for each infill line
3. WHEN enumeration is visible, THE UI Application SHALL display a numbered marker for each frame line
4. THE UI Application SHALL use circles with counter numbers for infill line markers
5. THE UI Application SHALL use squares with counter numbers for frame line markers
6. THE UI Application SHALL connect each marker to its target line with a dashed anchor line
7. THE UI Application SHALL position markers outside the frame boundary to minimize view obstruction
8. THE UI Application SHALL arrange markers to minimize anchor line crossings with each other

### Requirement 8

**User Story:** As a user, I want to view a bill of materials for the railing, so that I can understand the parts needed for manufacturing

#### Acceptance Criteria

1. THE UI Application SHALL display a bill of materials (BOM) table viewport
2. THE UI Application SHALL organize the BOM table with two tabs: one for frame parts and one for infill parts
3. THE UI Application SHALL display the following columns in each BOM table: unique ID number, length, cut angle at start, cut angle at end, and weight
4. THE UI Application SHALL calculate part weight using length and weight per meter parameters
5. THE UI Application SHALL calculate and display accurate values for all BOM columns based on the generated design
6. THE UI Application SHALL display total length sum for each table tab
7. THE UI Application SHALL display total weight sum for each table tab
8. THE UI Application SHALL display combined total length sum for both frame and infill parts
9. THE UI Application SHALL display combined total weight sum for both frame and infill parts
10. THE UI Application SHALL update the BOM table and totals when a new design is generated

### Requirement 8.1

**User Story:** As a user, I want to select parts in the BOM table and see them highlighted in the viewport, so that I can identify specific parts visually

#### Acceptance Criteria

1. WHEN a user selects an entry in the BOM table, THE UI Application SHALL highlight the corresponding part in the main viewport
2. THE UI Application SHALL maintain the highlight until a different part is selected or the selection is cleared
3. THE UI Application SHALL provide visual distinction for highlighted parts compared to non-highlighted parts
4. THE UI Application SHALL support selection in both frame parts and infill parts tabs

### Requirement 8.2

**User Story:** As a user, I want to save and load railing designs, so that I can preserve my work and share designs with others

#### Acceptance Criteria

1. THE UI Application SHALL provide a main menu with New Project, Save, Save As, Load, and Quit actions
2. WHEN saving, THE UI Application SHALL create a ZIP archive with *.rig.zip extension
3. THE UI Application SHALL include all parameters as a JSON file in the archive
4. WHEN saving with generated infill, THE UI Application SHALL include the complete infill solution geometry as JSON data in the archive
5. THE UI Application SHALL include the viewport visualization as a PNG image in the archive
6. THE UI Application SHALL render the PNG with the viewport zoomed to show the entire design
7. THE UI Application SHALL use a configurable resolution for PNG export from configuration files
8. THE UI Application SHALL include the frame parts BOM table as a CSV file in the archive
9. WHEN saving with generated infill, THE UI Application SHALL include the infill parts BOM table as a CSV file in the archive
10. WHEN loading, THE UI Application SHALL extract and restore all data from the ZIP archive
11. WHEN loading, THE UI Application SHALL restore all parameters from the JSON file
12. WHEN loading with saved infill data, THE UI Application SHALL restore and display the exact infill arrangement
13. WHEN loading, THE UI Application SHALL restore the UI to the exact same state as when it was saved
14. THE UI Application SHALL allow users to specify save and load file locations

### Requirement 8.2.1

**User Story:** As a user, I want to export designs to DXF format, so that I can use them in CAD software for manufacturing

#### Acceptance Criteria

1. THE UI Application SHALL provide an "Export to DXF" action in the main menu
2. WHEN Export to DXF is selected, THE UI Application SHALL export the frame geometry as DXF format
3. WHEN Export to DXF is selected with generated infill, THE UI Application SHALL export both frame and infill geometry as DXF format
4. THE UI Application SHALL organize frame and infill elements on separate layers in the DXF file
5. THE UI Application SHALL allow users to specify the export file location
6. THE UI Application SHALL only enable the Export to DXF action when a valid design exists

### Requirement 8.2.2

**User Story:** As a user, I want to manage my project workflow, so that I can start new projects and avoid losing unsaved work

#### Acceptance Criteria

1. WHEN New Project is selected, THE UI Application SHALL reset the application to default state
2. WHEN New Project is selected, THE UI Application SHALL reload default values from configuration files
3. WHEN Quit is selected with unsaved changes, THE UI Application SHALL display a warning dialog
4. THE UI Application SHALL display the current saved file name in the window title
5. WHEN the project has unsaved changes, THE UI Application SHALL mark the file name with an asterisk in the window title
6. THE UI Application SHALL track changes to determine if the project has been modified since last save

### Requirement 9

**User Story:** As a user, I want to regenerate infill with the same parameters, so that I can explore different random arrangements

#### Acceptance Criteria

1. THE UI Application SHALL provide a regenerate button or command
2. WHEN regenerate is triggered, THE Generator SHALL create a new random arrangement using the current parameters
3. THE Generator SHALL produce a different arrangement on each regeneration
4. THE UI Application SHALL update the visualization with the new arrangement

### Requirement 9.1

**User Story:** As a user, I want visual feedback during long-running operations, so that I know the application is working and can monitor progress

#### Acceptance Criteria

1. WHEN a long-running operation is in progress, THE UI Application SHALL display a progress dialog
2. THE UI Application SHALL show progress information in the progress dialog
3. THE UI Application SHALL display progress logs in the progress dialog
4. THE UI Application SHALL block input to the main application window while the progress dialog is visible
5. THE UI Application SHALL close the progress dialog when the operation completes

### Requirement 9.1.1

**User Story:** As a user, I want to see generation progress metrics, so that I can monitor the quality and performance of the infill generation

#### Acceptance Criteria

1. WHEN infill generation is in progress, THE UI Application SHALL display the current iteration number
2. THE UI Application SHALL display the best fitness score found so far
3. THE UI Application SHALL display the elapsed duration of the generation process
4. THE UI Application SHALL update these metrics in real-time during generation
5. WHEN a new best fitness score is found, THE UI Application SHALL update the main viewport with the corresponding infill arrangement
6. THE UI Application SHALL refresh the viewport visualization each time a better solution is discovered
6. THE UI Application SHALL display a cancel button to clancel the current operation.

### Requirement 9.2

**User Story:** As a user, I want the interface to indicate when short operations are running, so that I don't accidentally trigger multiple operations

#### Acceptance Criteria

1. WHEN a short-running operation is in progress, THE UI Application SHALL disable all input elements
2. THE UI Application SHALL visually indicate disabled state by graying out input elements
3. THE UI Application SHALL not display a progress dialog for short-running operations
4. THE UI Application SHALL re-enable input elements when the short operation completes

### Requirement 10

**User Story:** As a user, I want default parameter values stored in configuration files, so that I have sensible starting values for all parameters

#### Acceptance Criteria

1. THE UI Application SHALL store default shape parameter values in configuration files
2. THE UI Application SHALL store default infill parameter values in configuration files
3. THE UI Application SHALL store default generator parameter values in configuration files
4. THE UI Application SHALL organize configuration files by shape type and generator type
5. THE UI Application SHALL load default values from configuration on startup

### Requirement 11

**User Story:** As a developer, I want comprehensive application logging, so that I can troubleshoot issues and monitor application behavior

#### Acceptance Criteria

1. THE UI Application SHALL log to a file in the logs subdirectory by default
2. THE UI Application SHALL include the current date in the log filename
3. THE UI Application SHALL support a verbose command-line argument
4. WHEN the verbose argument is provided, THE UI Application SHALL log to both file and stdout
5. THE UI Application SHALL organize loggers in a hierarchical structure by component
6. THE UI Application SHALL use INFO as the default log level for the root logger
7. THE UI Application SHALL allow log levels to be configured per logger in the hierarchy via configuration files
8. THE UI Application SHALL support configuring log levels for individual components independently from the root logger
